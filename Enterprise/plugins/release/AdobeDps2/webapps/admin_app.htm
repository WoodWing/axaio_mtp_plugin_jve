<script src="../../server/jquery/jquery-1.10.2.min.js"></script>
<script src="../../server/jquery/jquery-ui-1.8.24.custom.min.js"></script>
<script src="../../server/dgrid/dojo/dojo.js" data-dojo-config="async: true"></script>
<script src="../../server/jquery/nhpup_1.1.js"></script>
<style>
.field-JobStatusInfo {
	width: 25px;
}
#pup {
  position:absolute;
  z-index:200; /* always on top*/
  padding: 3px;
  margin-left: 10px;
  margin-top: 5px;
  width: 250px;
  border: 1px solid black;
  background-color: #777;
  color: white;
  font-size: 8pt;
}
</style>
<script>
	require([
		"dojo/store/JsonRest",
		"dstore/RequestMemory",
		"dgrid/OnDemandGrid", 
		"dojo/domReady!"
	], function( JsonRest, RequestMemory, OnDemandGrid ){

		function renderStatusInfoCell( object, value, node, options ) {
			var div = document.createElement("div");
			div.innerHTML = '<img src="../../config/images/sinfo_16.gif" border="0" onmouseover="nhpup.popup(\''+object["JobStatusInfo"]+'\');"/>';
			return div;
		}

		function renderStatusCell( object, value, node, options ) {
			var div = document.createElement("div");
			switch( object["JobConditionFlag"] ) {
				case 'ERROR': div.style.color = '#FF0000'; break;
				case 'WARN': div.style.color = '#FF6600'; break;
			}
			div.innerHTML = value;
			return div;
		}
		
		var myStore, dataStore, grid;
		var ticket = "<!--VAR:TICKET-->";
		grid = new OnDemandGrid({
			collection: new RequestMemory({
				target: '../../config/plugins/AdobeDps2/webapps/uploadjobs.php?ticket='+ticket, 
				idProperty: 'JobId' 
			}),
			columns: [
				{ label:"<!--RES:PUBLICATION-->", field:"PublicationName" },
				{ label:"<!--RES:CHANNEL-->", field:"PubChannelName" },
				{ label:"<!--RES:OBJ_LAYOUT-->", field:"LayoutName", width: "125px" },
				{ label:"<!--RES:OBJ_VERSION-->", field:"LayoutVersion" },
				
				{ label:"<!--RES:AdobeDps2.AP_ARTICLE_UPLOAD_STATUS-->", field:"UploadStatus" },
				{ label:"", field:"JobStatusInfo", width: "10px", renderCell: renderStatusInfoCell },
				{ label:"<!--RES:SVR_JOBSTATUS-->", field:"JobStatus", renderCell: renderStatusCell },
				{ label:"<!--RES:SVR_JOBCONDITION-->", field:"JobCondition", renderCell: renderStatusCell },
				{ label:"<!--RES:SVR_JOBPROGRESS-->", field:"JobProgress" },

				{ label:"<!--RES:IDS_SERVER-->", field:"AssignedServer"},
				{ label:"<!--RES:USR_USER-->", field:"ActingUser"},
				{ label:"<!--RES:IDS_QUEUED_SINCE-->", field:"QueueTime", width: "70px" },
				{ label:"<!--RES:IDS_STARTED_AT-->", field:"StartTime", width: "70px" },
				{ label:"<!--RES:IDS_FINISHED_AT-->", field:"ReadyTime", width: "70px" }
			]
		}, "target-node-id"); // make sure you have a target HTML element with this id
		grid.startup();
	});
</script>

<form method="post">
	<table class="appframe">
        <tr class="text">
            <td style="<!--PAR:DISPLAY_ERRORMSG-->">
                <p class="subtitletext"><!--RES:ACT_REGISTER--></p>
                <!--PAR:PUBCHANNEL_REGISTER_BUTTON-->
                <p class="subtitletext"><!--RES:CHANNELS--></p>
                <table class="formbody">
                    <tr>
                        <th width="150"><!--RES:PUBLICATION--></th>
                        <th width="150"><!--RES:CHANNEL--></th>
                        <th width="150"><!--RES:AdobeDps2.PROJECT--></th>
                        <th></th>
                    </tr>
                    <!--SEC:CHANNEL_ROWS>-->
                    <tr>
                        <td><!--PAR:BRANDNAME--></td>
                        <td><a href="<!--PAR:PUBCHANNELURL-->" target="_blank"><!--PAR:PUBCHANNELNAME--></a></td>
                        <td><!--PAR:PUBCHANNEL_PROJECT--></td>
                        <td><!--PAR:PUBCHANNEL_SETPROJECT_BUTTON--></td>
                    </tr>
                    <!--SEC:<CHANNEL_ROWS-->
                </table>
            </td>
        </tr>
    </table>
    <!--VAR:MESSAGES-->
	<!--VAR:WEBAPPINDEX_HIDDENPARAMS-->
</form>

<div class="appframe">
	<p class="subtitletext"><!--VAR:UPLOADING_AP_ARTICLES--></p>
	<div id="target-node-id"></div>
</div>